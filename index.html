<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Async JS</title>
</head>
<body>
    <script>
//     const posts = [
//     {title: 'Post One', body: 'This is post one', createdAt: new Date().getTime()},
//     {title: 'Post Two', body: 'This is post two', createdAt: new Date().getTime()}
// ];

// let intervalId = 0;

// function getPosts(){
//     clearInterval(intervalId);
//     intervalId = setInterval(() => {
//         let output = '';
//         posts.forEach((post, index) => {
//             output += `<li>${post.title} - last updated ${(new Date().getTime() - post.createdAt) / 1000}  seconds ago </li>`
//         });
//         document.body.innerHTML = output;
//     }, 1000);
// }

// function createPosts(post, callback) {
//     setTimeout(()=>{
//         posts.push({...post, createdAt: new Date().getTime()});

//         callback();
//     },2000);
// }

// function create4thPost(post, callback){
//     setTimeout(() => {
//         posts.push({...post, createdAt: new Date().getTime()})
//         callback();
//     }, 4000)
// }

// getPosts();
// createPosts({title: 'Post Three', body: 'This is post three'}, getPosts);

// create4thPost({title: 'Post Four', body: 'This is post Four'}, getPosts);

// var timer;
// var count = 0;
// function lastEditedInSecondsAgo(){
//     count = 0;
//     clearInterval(timer)
//     timer = setInterval(() => {
//         count++
//         console.log(count)
//     }, 2000);
// }


const posts = [
    {title: 'Post One', body: 'This is post one', createdAt: new Date().getTime()},
    {title: 'Post Two', body: 'This is post two', createdAt: new Date().getTime()}
];


function getPosts(){
        setTimeout(() => {
        let output = '';
        posts.forEach((post, index) => {
         output += `<li>${post.title} - last updated ${(new Date().getTime() - post.createdAt) / 1000}  seconds ago </li>`
        });
        document.body.innerHTML = output;
    }, 1000);
}

    function createPosts(post){
        return new Promise((resolve, reject) => {
            setTimeout(()=>{
            posts.push({...post, createdAt: new Date().getTime()});

            const error = false;
            if(!error){
                resolve();
            }else{
                reject('Error: Something went wrong');
            }
        }, 2000);
        })

    }


//     function create4thPost(post){
//         return new Promise((resolve, reject) => {
//             setTimeout(() => {
//                 posts.push({...post, createdAt: new Date().getTime()});

//                 const error = false;
//                 if(!error){
//                     resolve();
//                 } else {
//                     reject('Something went wrong');
//                 }
//             }, 3000)
//         })
//     }

//   function deletePosts(){
//     return new Promise((resolve, reject) => {
//         setTimeout(() =>{
//         if(posts.length > 0){
//             resolve(posts.pop());
//             }else{
//                 reject('array is empty now');
//             }
//         },1000);
//     })
//   }


//     createPosts({title: 'Post Three', body: 'This is post three'})
//    .then(() =>{
//     getPosts()
//     deletePosts().then(() =>{
//         getPosts()
//         deletePosts().then(() =>{ 
//             getPosts()
//             deletePosts().then(() =>{
//                 getPosts() 
//                 deletePosts().then(() =>{
//                     getPosts()
//             }).catch(err => console.log(err))
//             })
//         })  
// })
//    })
// .catch(err => console.log(err))

// create4thPost({title: 'Post Four', body: 'This is post four'})
// .then(() =>{
//     getPosts()
//     deletePosts()
// }).catch(err => console.log(err))




// Promise.all
// const promise1 = Promise.resolve('Hello World');
// const promise2 = 10;
// const promise3 = new Promise((resolve, reject) =>
// setTimeout(resolve, 2000, 'Goodbye'));



// Promise.all([promise1,promise2,promise3]).then(values => console.log(values));


const user = {
    username: 'ritik',
    lastactivitytime: '17th of sept'
}

function updatelastactivitytime(post){
    return new Promise((resolve, reject) => {
        setTimeout(() =>{
            user.lastactivitytime = new Date().getTime;
            if(posts !== 0){
            resolve(user.lastactivitytime) ;               
            }else{
                reject('Array is empty now'); 
            }
        },1000);
    })
  }


 createPosts({title: 'Post Three', body: 'This is post three'}, getPosts)
 function userupdatepost(posts){
    Promise.all([createPosts, updatelastactivitytime])
    .then(([createPostsresolves, updatelastactivitytimeresolves]) =>{
        console.log(updatelastactivitytimeresolves)
    })
    .catch(err => console.log(err))
  };


    </script>
</body>
</html>